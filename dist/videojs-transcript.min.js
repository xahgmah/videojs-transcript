/*! videojs-transcript - v0.8.0 - 2017-03-20
* Copyright (c) 2017 Matthew Walsh; Licensed MIT */
!function(a,b){"use strict";!function(){for(var b=0,c=["ms","moz","webkit","o"],d=0;d<c.length&&!a.requestAnimationFrame;++d)a.requestAnimationFrame=a[c[d]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[c[d]+"CancelAnimationFrame"]||a[c[d]+"CancelRequestAnimationFrame"];a.requestAnimationFrame||(a.requestAnimationFrame=function(c,d){var e=(new Date).getTime(),f=Math.max(0,16-(e-b)),g=a.setTimeout(function(){c(e+f)},f);return b=e+f,g}),a.cancelAnimationFrame||(a.cancelAnimationFrame=function(a){clearTimeout(a)})}(),"function"!=typeof Object.create&&(Object.create=function(){var a=function(){};return function(b){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof b)throw TypeError("Argument must be an object");a.prototype=b;var c=new a;return a.prototype=null,c}}()),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;d<f;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),"document"in self&&!("classList"in document.createElement("_"))&&!function(a){if("Element"in a){var b="classList",c="prototype",d=a.Element[c],e=Object,f=String[c].trim||function(){return this.replace(/^\s+|\s+$/g,"")},g=Array[c].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},h=function(a,b){this.name=a,this.code=DOMException[a],this.message=b},i=function(a,b){if(""===b)throw new h("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new h("INVALID_CHARACTER_ERR","String contains an invalid character");return g.call(a,b)},j=function(a){for(var b=f.call(a.getAttribute("class")||""),c=b?b.split(/\s+/):[],d=0,e=c.length;d<e;d++)this.push(c[d]);this._updateClassName=function(){a.setAttribute("class",this.toString())}},k=j[c]=[],l=function(){return new j(this)};if(h[c]=Error[c],k.item=function(a){return this[a]||null},k.contains=function(a){return a+="",i(this,a)!==-1},k.add=function(){var d,a=arguments,b=0,c=a.length,e=!1;do d=a[b]+"",i(this,d)===-1&&(this.push(d),e=!0);while(++b<c);e&&this._updateClassName()},k.remove=function(){var d,a=arguments,b=0,c=a.length,e=!1;do{d=a[b]+"";var f=i(this,d);f!==-1&&(this.splice(f,1),e=!0)}while(++b<c);e&&this._updateClassName()},k.toggle=function(a,b){a+="";var c=this.contains(a),d=c?b!==!0&&"remove":b!==!1&&"add";return d&&this[d](a),!c},k.toString=function(){return this.join(" ")},e.defineProperty){var m={get:l,enumerable:!0,configurable:!0};try{e.defineProperty(d,b,m)}catch(a){a.number===-2146823252&&(m.enumerable=!1,e.defineProperty(d,b,m))}}else e[c].__defineGetter__&&d.__defineGetter__(b,l)}}(self);var c={};c.settings={},c.prefix="transcript",c.player=this;var d={autoscroll:!0,clickArea:"text",showTitle:!0,showTrackSelector:!0,followPlayerTrack:!0,scrollToCenter:!1,stopScrollWhenInUse:!0},e=function(a){return{secondsToTime:function(a){var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.floor(a%60);return d=d<10?"0"+d:d,c=b>0&&c<10?"0"+c:c,b>0?b+":"+c+":"+d:c+":"+d},localize:function(a){return a},createEl:function(b,c){c=c||"";var d=document.createElement(b);return d.className=a.prefix+c,d},extend:function(a){var b=typeof a;if(!("function"===b||"object"===b&&a))return a;for(var c,d,e=1,f=arguments.length;e<f;e++){c=arguments[e];for(d in c)a[d]=c[d]}return a}}}(c),f={handlers_:[],on:function(b,c,d){if("function"!=typeof d)throw new TypeError("Callback is not a function.");this.handlers_.push([b,c,d])},trigger:function(b,c){this.handlers_.forEach(function(a){a[0]===b&&a[1]===c&&a[2].apply()})}},g=function(a){var b=function(a){var b=this;a.addEventListener("scroll",function(){b.isAutoScrolling?b.isAutoScrolling=!1:(b.userIsScrolling=!0,a.classList.add("is-inuse"))}),a.addEventListener("mouseenter",function(){b.mouseIsOverTranscript=!0}),a.addEventListener("mouseleave",function(){b.mouseIsOverTranscript=!1,setTimeout(function(){b.mouseIsOverTranscript||(b.userIsScrolling=!1,a.classList.remove("is-inuse"))},1e3)})},c=function(a,c){return this.element=a,this.userIsScrolling=!1,this.mouseIsOverTranscript=!0,this.isAutoScrolling=!0,b.call(this,this.element),this},d=function(a,b,c,d){return b+c*Math.sin(Math.min(1,a/d)*(Math.PI/2))},e=function(a,b,c){var e=Date.now(),f=a.scrollTop,g=this;b=Math.max(0,b),b=Math.min(a.scrollHeight-a.clientHeight,b);var h=b-f,i=function(){var j=Date.now(),k=j-e;g.isAutoScrolling=!0,a.scrollTop=d(k,f,h,c),a.scrollTop!==b&&requestAnimationFrame(i,a)};requestAnimationFrame(i,a)},f=function(b){if(this.canScroll()){var i,j,c=b.parentElement,d=c.offsetTop+c.clientHeight,f=b.offsetTop+b.clientHeight,g=b.offsetTop-c.offsetTop,h=b.offsetTop+b.clientHeight-c.offsetTop;a.settings.scrollToCenter&&(i=Math.round(c.clientHeight/2-b.clientHeight/2)),g<c.scrollTop+i?j=b.offsetTop-c.offsetTop-i:h>c.scrollTop+c.clientHeight-i&&(j=f-d+i),void 0!==j&&c.scrollTop!==j&&e.call(this,c,j,400)}},g=function(){var a=this.element;return a.scrollHeight>a.offsetHeight},h=function(){return this.userIsScrolling};return{init:c,to:f,canScroll:g,inUse:h}}(c),h=function(a){return Object.create(g).init(a)},i=function(a){var b;return{get:function(){var b,d,a=[];for(c.tracks=c.player.textTracks(),b=0;b<c.tracks.length;b++)d=c.tracks[b],"captions"!==d.kind&&"subtitles"!==d.kind||a.push(d);return a},active:function(a){var d,e;for(d=0;d<c.tracks.length;d++)if(e=c.tracks[d],"showing"===e.mode)return b=e,e;return b||a[0]}}}(c),j=function(b){var c={};c.element={},c.body={};var d=function(a,b){f.on(this,a,b)},g=function(a){f.trigger(this,a)},i=function(){var a=e.createEl("header","-header");return a.textContent=e.localize("Transcript"),a},j=function(){var a=e.createEl("select","-selector");return b.validTracks.forEach(function(b,c){var d=document.createElement("option");d.value=c,d.textContent=b.label+" ("+b.language+")",a.appendChild(d)}),a.addEventListener("change",function(a){o(document.querySelector("#"+b.prefix+"-"+b.player.id()+" option:checked").value),g("trackchanged")}),a},k=function(a){var c=a.target.classList,d=a.target.getAttribute("data-begin")||a.target.parentElement.getAttribute("data-begin");void 0!==d&&null!==d&&("line"===b.settings.clickArea||"timestamp"===b.settings.clickArea&&c.contains(b.prefix+"-timestamp")||"text"===b.settings.clickArea&&c.contains(b.prefix+"-text"))&&b.player.currentTime(d)},l=function(a){var b=e.createEl("div","-line"),c=e.createEl("span","-timestamp"),d=e.createEl("span","-text");return b.setAttribute("data-begin",a.startTime),c.textContent=e.secondsToTime(a.startTime),d.innerHTML=a.text,b.appendChild(c),b.appendChild(d),b},m=function(d){"object"!=typeof d&&(d=b.player.textTracks()[d]);var g,i,f=e.createEl("div","-body"),j=document.createDocumentFragment();if(d.activeCues){var n=d.cues;for(i=0;i<n.length;i++)g=l(n[i]),j.appendChild(g);f.innerHTML="",f.appendChild(j),f.setAttribute("lang",d.language),f.scroll=h(f),f.addEventListener("click",k),c.element.replaceChild(f,c.body),c.body=f}else"showing"!==d.mode&&(d.mode="hidden"),a.setTimeout(function(){m(d)},100)},n=function(){var a=document.createElement("div");if(c.element=a,a.setAttribute("id",b.prefix+"-"+b.player.id()),b.settings.showTitle){var d=i();a.appendChild(d)}if(b.settings.showTrackSelector){var f=j();a.appendChild(f)}return c.body=e.createEl("div","-body"),a.appendChild(c.body),o(b.currentTrack),this},o=function(a,b){m(a,b)},p=function(a){var e,f,g,h,i=c.body.children;for(e=0;e<i.length;e++)f=i[e],g=f.getAttribute("data-begin"),h=e<i.length-1?i[e+1].getAttribute("data-begin"):b.player.duration()||1/0,a>g&&a<h?f.classList.contains("is-active")||(f.classList.add("is-active"),!b.settings.autoscroll||b.settings.stopScrollWhenInUse&&c.body.scroll.inUse()||c.body.scroll.to(f)):f.classList.remove("is-active")},q=function(){return c.element};return{create:n,setTrack:o,setCue:p,el:q,on:d,trigger:g}}(c),k=function(a){c.player=this,c.validTracks=i.get(),c.currentTrack=i.active(c.validTracks),c.settings=b.mergeOptions(d,a),c.widget=j.create();var e=function(){c.widget.setCue(c.player.currentTime())},f=function(){c.currentTrack=i.active(c.validTracks),c.widget.setTrack(c.currentTrack)};if(!(c.validTracks.length>0))throw new Error("videojs-transcript: No tracks found!");return f(),c.player.on("timeupdate",e),c.settings.followPlayerTrack&&(c.player.on("captionstrackchange",f),c.player.on("subtitlestrackchange",f)),{el:function(){return c.widget.el()},setTrack:c.widget.setTrack}};b.plugin("transcript",k)}(window,videojs);
